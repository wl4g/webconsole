<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>XCloud WebConsole</title>
	<meta name="renderer" content="webkit">
	<meta name="force-rendering" content="webkit">

	<link rel="stylesheet" href="css/xterm.css" />

	<script src="js/xterm.js"></script>

	<script src="js/jquery-3.5.1.min.js"></script>

</head>
<body>
	Welcome to XCloud WebConsole !

	<div id="terminal"></div>

	<script>
		/*const term = new Terminal();
		term.open(document.getElementById('terminal'));
		term.write('Hello from \x1B[1;3;31mxterm.js\x1B[0m $ ')*/

		/*var window_width = $(window).width();
		var window_height = $(window).height();
		var term = new Terminal(
				{
					cols: Math.floor(window_width/10),
					rows: Math.floor(window_height/20),
					useStyle:false,
					convertEol: true,
					cursorBlink:true,
					cursorStyle:null,
				});
		console.log("高度" + window_height + "宽度" + window_width);
		term.open(document.getElementById('terminal'));

		term.onData(send => console.debug(send));*/

		/*var sock = new WebSocket("ws://" + window.location.host + "/echo/");
		sock.addEventListener("open",function () {
			term.open(document.getElementById('terminal'));
		});
		sock.addEventListener("message",function (recv) {
			term.write(recv.data);
		});
		term.on("data",function(data){
			sock.send(data);
		});
		window.sock = sock;*/



		const socket = new WebSocket('ws://localhost:8888/ws/ee');

		socket.onopen = function () {

			let window_width = $(window).width();
			let window_height = $(window).height();
			let term = new Terminal(
					{
						cols: Math.floor(window_width/10),
						rows: Math.floor(window_height/20),
						useStyle:false,
						convertEol: true,
						cursorBlink:true,
						cursorStyle:null,
					});

			term.open(document.getElementById('terminal'));

			term.onData(send => socket.send(send));
			socket.onmessage = function (msg) {
				console.log(msg);
				console.log(msg.data);
				term.write(msg.data);
			};
			socket.onerror = function (e) {
				console.log(e);
			};

			socket.onclose = function (e) {
				console.log(e);
				term.destroy();
			};
		};


	</script>
</body>
</html>
